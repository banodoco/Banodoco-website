import fs from 'node:fs';
import path from 'node:path';

const repoRoot = process.cwd();
const picsDir = path.join(repoRoot, 'public', 'profile_pics');
const outFile = path.join(
  repoRoot,
  'src',
  'components',
  'sections',
  'Ownership',
  'profilePicsManifest.ts',
);

function isJpg(filename) {
  return filename.toLowerCase().endsWith('.jpg');
}

function main() {
  if (!fs.existsSync(picsDir)) {
    console.error(`[profile-pics] Missing directory: ${picsDir}`);
    process.exit(1);
  }

  const files = fs
    .readdirSync(picsDir)
    .filter(isJpg)
    .map((f) => f.replace(/\.jpg$/i, ''))
    .filter(Boolean)
    .sort((a, b) => a.localeCompare(b));

  const content = `// This file is auto-generated by scripts/generate-profile-pics-manifest.mjs
// Do not edit by hand.

export const PROFILE_PIC_IDS = ${JSON.stringify(files, null, 2)} as const;

export type ProfilePicId = (typeof PROFILE_PIC_IDS)[number];
`;

  fs.mkdirSync(path.dirname(outFile), { recursive: true });
  fs.writeFileSync(outFile, content, 'utf8');

  console.log(`[profile-pics] Wrote ${files.length} ids to ${path.relative(repoRoot, outFile)}`);
}

main();


