<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Struggle & Triumph - Story Of The Animatediff Ecosystem</title>
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.151.3/build/three.module.js"
    }
  }
  </script>
  <link rel="icon" href="assets/logos/banodoco.png" type="image/png" />
  <link rel="shortcut icon" href="assets/logos/banodoco.png" type="image/png" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Space+Grotesk:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">

  <!-- Main CSS -->
  <link rel="stylesheet" href="src/styles/main.css" />

  <!-- Header & Footer component CSS -->
  <link rel="stylesheet" href="src/styles/components/header.css" />
  <link rel="stylesheet" href="src/styles/components/footer.css" />

  <!-- Feather Icons (similar to Lucide) -->
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <style>
    /* Hide image element on iPad and mobile screens */
    @media (max-width: 1024px) { /* iPad and smaller */
      .ecosystem-visualization {
        display: none;
      }
      .text-column { /* Allow text column to take full width on smaller screens */
        max-width: 100% !important;
        flex-basis: 100% !important;
      }
      .hero-title {
        margin-top: 50px;
      }
    }

    /* Enhanced image hover effects */
    .ecosystem-visualization img {
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      position: relative;
      overflow: hidden;
    }

    .ecosystem-visualization img:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3) !important;
      z-index: 10;
    }

    /* Shine effect */
    .ecosystem-visualization img::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.4),
        transparent
      );
      transition: left 0.6s ease;
      z-index: 1;
      pointer-events: none;
    }

    .ecosystem-visualization img:hover::before {
      left: 100%;
    }

    /* Subtle glow effect */
    .ecosystem-visualization img:hover {
      filter: brightness(1.1) contrast(1.05);
    }

    /* Staggered hover delay for a wave effect */
    .ecosystem-visualization img:nth-child(1) { transition-delay: 0ms; }
    .ecosystem-visualization img:nth-child(2) { transition-delay: 50ms; }
    .ecosystem-visualization img:nth-child(3) { transition-delay: 100ms; }
    .ecosystem-visualization img:nth-child(4) { transition-delay: 150ms; }
    .ecosystem-visualization img:nth-child(5) { transition-delay: 200ms; }
    .ecosystem-visualization img:nth-child(6) { transition-delay: 250ms; }
    .ecosystem-visualization img:nth-child(7) { transition-delay: 300ms; }
    .ecosystem-visualization img:nth-child(8) { transition-delay: 350ms; }
    .ecosystem-visualization img:nth-child(9) { transition-delay: 400ms; }
    .ecosystem-visualization img:nth-child(10) { transition-delay: 450ms; }

    /* Add a subtle border that appears on hover */
    .ecosystem-visualization img::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border: 2px solid transparent;
      border-radius: 4px;
      transition: border-color 0.3s ease;
      pointer-events: none;
    }

    .ecosystem-visualization img:hover::after {
      border-color: rgba(252, 192, 97, 0.6);
    }

    /* Prevent horizontal scrolling */
    html, body {
      overflow-x: hidden;
      max-width: 100%;
    }
    
    .container {
      max-width: 100%;
      overflow-x: hidden;
    }
    
    .ecosystem-visualization {
      overflow: visible;
      max-width: 100%;
    }

    @media (min-width: 1025px) {
      #header {
        margin-bottom: 2rem;
      }
      .two-column {
        display: flex;
        align-items: stretch;
      }
      .two-column .text-column,
      .two-column .ecosystem-visualization {
        margin-top: 0 !important;
      }
      .two-column .ecosystem-visualization {
        margin-top: 20px !important;
      }
      .ecosystem-visualization > div {
        height: 100%;
      }
      .ecosystem-visualization img {
        transform: none !important;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
    }
  </style>
</head>

<body class="ownership-page">
  <canvas id="plantCanvas"></canvas>
  <div class="plant-overlay"></div>
  <!-- POM Border -->
  <div class="inner-border"></div>

  <div class="container" style="position: relative;">
    <!-- Site Header -->
    <div id="header"></div>
    <script>
      fetch('src/components/header.html')
        .then(response => response.text())
        .then(html => { document.getElementById('header').innerHTML = html; });
    </script>

    <!-- Hero Section -->
    <div class="content-section">
      <div class="two-column" style="gap: 3rem;">
        <div class="text-column" style="max-width: 40%; flex: 0 0 40%; margin-top: -25px;">
          <h1 class="hero-title">
            Struggle & Triumph - The Story Of The Animatediff Ecosystem
          </h1>
          <p>
            Objectively, most of the control mechanisms now popular in AI video were pioneered in the Animatediff ecosystem. 
          </p>
          <p>
            Subjectively, much of the early AI art that was made with true craft and intentionality was created with Animatediff.
          </p>
          <p>
            I'd like to tell the story of this ecosystem by explaining the advances and innovations that fueled it, and showing the art that came from them. 
          </p>
          <p>
            To do this, I would like to use a mix of input materials like test generations, and completed artworks - each of which I will make into an NFT.
          </p>
          <p>
            The goal of this will be to tell our story, earn money for both Banodoco and people who participate, and explore if and how a larger crypto initiative aimed at supporting the ecosystem could work.
          </p>
          <p>
            If you're seeing this, it means I'd hugely appreciate your participation. 
          </p>
          <p style="font-family: 'Dancing Script', cursive; font-size: 1.5rem; text-align: left; margin-top: 1rem; margin-left: 0;">
            POM
          </p>
        </div>
        <div class="ecosystem-visualization" style="margin-top: 15px; margin-left: 20px; max-width: 40%; flex: 0 0 40%;">
          <!-- Placeholder GIF collage -->
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(5, 1fr); gap: 10px; padding: 20px; height: 100%;">
            <img src="test.gif" alt="Test GIF 1" style="width: 100%; border-radius: 4px; z-index: 1; position: relative; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <img src="test.gif" alt="Test GIF 2" style="width: 100%; border-radius: 4px; z-index: 2; position: relative; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <img src="test.gif" alt="Test GIF 3" style="width: 100%; border-radius: 4px; transform: translateY(-20px); z-index: 7; position: relative; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <img src="test.gif" alt="Test GIF 4" style="width: 100%; border-radius: 4px; transform: translateY(-20px); z-index: 8; position: relative; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <img src="test.gif" alt="Test GIF 5" style="width: 100%; border-radius: 4px; transform: translateY(-20px); z-index: 5; position: relative; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <img src="test.gif" alt="Test GIF 6" style="width: 100%; border-radius: 4px; transform: translateY(-20px); z-index: 6; position: relative; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <img src="test.gif" alt="Test GIF 7" style="width: 100%; border-radius: 4px; transform: translateY(-20px); z-index: 9; position: relative; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <img src="test.gif" alt="Test GIF 8" style="width: 100%; border-radius: 4px; transform: translateY(-20px); z-index: 10; position: relative; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <img src="test.gif" alt="Test GIF 9" style="width: 100%; border-radius: 4px; transform: translateY(-20px); z-index: 11; position: relative; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
            <img src="test.gif" alt="Test GIF 10" style="width: 100%; border-radius: 4px; transform: translateY(-20px); z-index: 12; position: relative; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
          </div>
        </div>
      </div>
    </div>

    <!-- Divider -->
    <hr class="section-divider" />

    <!-- Submission Section -->
    <div class="content-section" id="submission-section">
      <h2 class="submission-title" style="margin-bottom: 2rem; color: #333;">Submit your generations & art:</h2>
      <div class="two-column" style="gap: 3rem; align-items: stretch;">
        <div class="text-column" style="max-width: 45%; flex: 0 0 45%;">
          <form id="submission-form" style="background: rgba(255, 255, 255, 0.9); padding: 2rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
            <div style="margin-bottom: 1.5rem;">
              <label for="name" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #333;">Your Name:</label>
              <input type="text" id="name" name="name" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s ease; box-sizing: border-box;" onfocus="this.style.borderColor='#5353a5'" onblur="this.style.borderColor='#e0e0e0'">
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label for="split" style="display: flex; align-items: center; margin-bottom: 0.75rem; font-weight: 500; color: #333;">
                Revenue split percentage:
                <div class="tooltip-container" style="position: relative; display: inline-flex; align-items: flex-end; margin-left: 8px; margin-bottom: -2px; margin-top: 2px;">
                  <span style="cursor: help; font-family: 'Inter', sans-serif; font-weight: bold; color: #5353a5; border: 1px solid #5353a5; border-radius: 50%; width: 18px; height: 18px; display: inline-flex; align-items: center; justify-content: center; font-size: 0.8rem; padding-top: 1px;" class="info-icon" tabindex="0">i</span>
                  <div class="tooltip-text" style="width: 220px; background-color: #333; color: #fff; text-align: left; border-radius: 6px; padding: 10px; position: absolute; z-index: 10; bottom: 140%; left: 50%; transform: translateX(-50%); transition: opacity 0.3s ease, visibility 0.3s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.2); font-weight: normal; font-size: 0.85rem; line-height: 1.4;">
                    After expenses including minting and listing fees. This figure will be included on the listing.
                  </div>
                </div>
              </label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="split" name="split" min="0" max="100" value="50" style="flex: 1; height: 6px; background: #e0e0e0; border-radius: 3px; outline: none; -webkit-appearance: none;" oninput="updateSplitValues(this.value)">
              </div>
              <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.85rem; color: #666;">
                <span>Banodoco: <span id="banodocoPercent" style="font-weight: 600;">50%</span></span>
                <span>You: <span id="youPercent" style="font-weight: 600;">50%</span></span>
              </div>
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label for="description" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #333;">Include any relevant description:</label>
              <textarea id="description" name="description"  style="width: 100%; min-height: 100px; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s ease; box-sizing: border-box; resize: vertical; font-family: inherit;" onfocus="this.style.borderColor='#5353a5'" onblur="this.style.borderColor='#e0e0e0'"></textarea>
            </div>

            <div style="margin-bottom: 1.5rem; margin-top: 0.5rem;">
              <label style="display: flex; align-items: flex-start; cursor: pointer; line-height: 1.4;">
                <input type="checkbox" id="permission" name="permission" style="margin-right: 0.75rem; margin-top: 0.3rem; transform: scale(1.2);">
                <span style="color: #333;">I give permission to Banodoco, Inc. to use the attached generations for the struggle collection</span>
              </label>
            </div>

            <div class="button-tooltip-container">
              <button type="submit" id="submit-generations-button" style="display: block; width: 100%; padding: 0.9rem; background: linear-gradient(135deg, #FCC061 0%, #F85B65 45%, #501F96 100%); color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 0.0rem;" disabled>Submit Generations</button>
              <div class="button-tooltip-text" id="button-tooltip">You need to have uploaded to submit</div>
            </div>
            <p style="margin-top: 1rem; text-align: center; font-size: 0.9rem; color: #666; font-style: italic;">Note: you can upload multiple batches. We will choose the most suitable items to include.</p>
            
            <!-- Enhanced Progress Section -->
            <div id="upload-progress-container" style="margin-top: 1.5rem; display: none;">
              <div style="background: rgba(83, 83, 165, 0.05); border-radius: 8px; padding: 1.5rem; border: 1px solid rgba(83, 83, 165, 0.2);">
                <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                  <div class="spinner" id="main-spinner" style="margin-right: 0.75rem;"></div>
                  <h3 id="progress-title" style="margin: 0; color: #5353a5; font-size: 1.1rem;">Preparing upload...</h3>
                </div>
                
                <div id="overall-progress-bar" style="width: 100%; height: 8px; background: #e0e0e0; border-radius: 4px; margin-bottom: 1rem; overflow: hidden;">
                  <div id="overall-progress-fill" style="height: 100%; background: linear-gradient(90deg, #FCC061, #F85B65); width: 0%; transition: width 0.3s ease; border-radius: 4px;"></div>
                </div>
                
                <div id="file-progress-list" style="max-height: 200px; overflow-y: auto;"></div>
                
                <div id="progress-summary" style="text-align: center; margin-top: 1rem; font-size: 0.9rem; color: #666;"></div>
              </div>
            </div>
            
            <div id="submission-status" style="margin-top: 1rem; text-align: center; font-size: 0.9rem;"></div>
          </form>
        </div>
        <div id="dropzone" style="display: flex; align-items: center; justify-content: center; border: 3px dashed #FCC061; min-height: 250px; border-radius: 12px; padding: 2rem; background: rgba(252, 192, 97, 0.05); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.backgroundColor='rgba(252, 192, 97, 0.1)'; this.style.borderColor='#F0A040'" onmouseout="this.style.backgroundColor='rgba(252, 192, 97, 0.05)'; this.style.borderColor='#FCC061'">
          <input type="file" id="file-input" multiple accept="*/*" style="display: none;">
          <div style="text-align: center; pointer-events: auto;">
            <div style="font-size: 3rem; margin-bottom: 1rem; color: #B8762E;">📁</div>
            <p style="font-size: 1.1rem; color: #B8762E; font-weight: 500; margin-bottom: 0.5rem;">Drop multimedia files here or click to upload</p>
            <p style="font-size: 0.9rem; color: #999;" id="dropzone-helper-text">(Min 1 file, any multimedia format)</p>
            <div id="file-list" style="margin-top: 1rem; font-size: 0.9rem; color: #333; text-align: left;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Divider -->


    <!-- Insert the container for the new, fetched footer -->
    <div id="footer"></div>
     <script>
      fetch('src/components/footer.html')
        .then(response => response.text())
        .then(html => {
          const footerElement = document.getElementById('footer');
          footerElement.innerHTML = html;
          // After injecting the footer, render any Feather icons that were just added
          if (window.feather) {
            feather.replace();
          }
          // Dynamically load and initialize the watering-can / plant animation interactions
          import('./src/js/components/plant-init.js')
            .then(mod => {
              if (typeof mod.initializePlantAnimation === 'function') {
                mod.initializePlantAnimation();
              }
            })
            .catch(err => console.error('Could not load plant-init.js:', err));
        })
        .catch(err => console.error('Error loading footer.html:', err));
    </script>
  </div>

  <script src="src/js/components/icons.js"></script>
  <script src="src/js/components/plant-animation.js" type="module"></script>

  <style>
    .floating-emoji {
      position: absolute;
      /* font-size will be set by JS */
      pointer-events: none;
      z-index: 1000;
      /* animation property removed here, will be set by JS */
    }

    @keyframes floatUp { /* 3s duration */
      0%   { opacity: 1; transform: translateY(0)    rotate(0deg)  scale(1); }
      25%  {             transform: translateY(-20px)  rotate(-5deg) scale(1.1); }
      50%  {             transform: translateY(-40px)  rotate(3deg)  scale(1); }
      75%  { opacity: 0.7; transform: translateY(-60px) rotate(-2deg) scale(0.9); }
      100% { opacity: 0; transform: translateY(-80px)  rotate(0deg)  scale(0.8); }
    }

    @keyframes floatUpQuickly { /* 5s duration - slower than main */
      0%   { opacity: 1; transform: translateY(0)    rotate(0deg)  scale(1); }
      15%  { opacity: 0.95; transform: translateY(-8px) rotate(-8deg) scale(1.05); }
      30%  { opacity: 0.9; transform: translateY(-16px) rotate(6deg) scale(1.05); }
      45%  { opacity: 0.6; transform: translateY(-24px) rotate(-4deg) scale(0.95); }
      60%  { opacity: 0.3; transform: translateY(-32px) rotate(3deg) scale(0.9); }
      75%  { opacity: 0.1; transform: translateY(-40px) rotate(-2deg) scale(0.85); }
      90%  { opacity: 0.05; transform: translateY(-48px) rotate(1deg) scale(0.8); }
      100% { opacity: 0; transform: translateY(-56px) rotate(0deg) scale(0.7); }
    }

    .tooltip-container .tooltip-text {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition: opacity 0.3s ease, visibility 0.3s ease; /* Ensure visibility is transitioned too */
    }

    .tooltip-container:hover .tooltip-text,
    .tooltip-container:focus-within .tooltip-text {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
    }

    /* Disabled button styles */
    #submit-generations-button:disabled {
        background: #ccc !important;
        cursor: not-allowed !important;
        transform: none !important;
        box-shadow: none !important;
    }

    /* Tooltip for disabled button */
    .button-tooltip-container {
        position: relative;
        display: inline-block;
        width: 100%;
    }

    .button-tooltip-text {
        width: 250px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 8px;
        position: absolute;
        z-index: 10;
        bottom: 102%;
        left: 50%;
        transform: translateX(-50%);
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        font-size: 0.9rem;
        pointer-events: none;
    }

    .button-tooltip-container:hover .button-tooltip-text {
        opacity: 1;
        visibility: visible;
    }

    /* Spinner animations */
    .spinner {
        width: 20px;
        height: 20px;
        border: 2px solid #e0e0e0;
        border-top: 2px solid #5353a5;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        display: inline-block;
    }

    .mini-spinner {
        width: 14px;
        height: 14px;
        border: 2px solid #e0e0e0;
        border-top: 2px solid #FCC061;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        display: inline-block;
        margin-right: 0.5rem;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* File progress item styles */
    .file-progress-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 6px;
        border-left: 4px solid #e0e0e0;
        transition: all 0.3s ease;
    }

    .file-progress-item.uploading {
        border-left-color: #FCC061;
        background: rgba(252, 192, 97, 0.1);
    }

    .file-progress-item.completed {
        border-left-color: #4CAF50;
        background: rgba(76, 175, 80, 0.1);
    }

    .file-progress-item.error {
        border-left-color: #F44336;
        background: rgba(244, 67, 54, 0.1);
    }

    .file-info {
        flex: 1;
        margin-right: 1rem;
    }

    .file-name {
        font-weight: 500;
        color: #333;
        font-size: 0.9rem;
        margin-bottom: 0.25rem;
    }

    .file-size {
        font-size: 0.8rem;
        color: #666;
    }

    .file-status {
        display: flex;
        align-items: center;
        font-size: 0.85rem;
        min-width: 100px;
        justify-content: flex-end;
    }

    .status-icon {
        margin-left: 0.5rem;
        font-size: 1rem;
    }

    /* Progress bar for individual files */
    .file-progress-bar {
        width: 100%;
        height: 4px;
        background: #e0e0e0;
        border-radius: 2px;
        overflow: hidden;
        margin-top: 0.5rem;
    }

    .file-progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #FCC061, #F85B65);
        width: 0%;
        transition: width 0.3s ease;
        border-radius: 2px;
    }

    /* Pulse animation for active uploads */
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.7; }
        100% { opacity: 1; }
    }

    .uploading .file-progress-fill {
        animation: pulse 1.5s ease-in-out infinite;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    const SUPABASE_URL = 'https://ddbobialzdjkzainyqgb.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkYm9iaWFsemRqa3phaW55cWdiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2MzQ0MTgsImV4cCI6MjA2MjIxMDQxOH0.CAstIrTFMcIAIDht0ZacLYY-obBptH3XXShohSzbwjU';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    console.log('Supabase client initialized:', supabase);

    // Floating emoji and split value functions (already present)
    function updateSplitValues(valueString) {
      const value = parseInt(valueString, 10); // Parse value to integer
      const banodocoPercent = 100 - value;
      const youPercent = value;
      
      document.getElementById('banodocoPercent').textContent = banodocoPercent + '%';
      document.getElementById('youPercent').textContent = youPercent + '%';

      // Trigger emoji animation at extreme values
      if (value === 0 || value === 100) {
        // main shocked face right away, 3s duration
        createFloatingEmoji(value); 

        // queue a second, smaller reaction right after but slower
        setTimeout(() => {
          if (value === 100) {
            // far right – raise eyebrow, smaller, slower
            createFloatingEmoji(value, '🤨', '1rem', 5);
          } else { // value === 0
            // far left – heart eyes, smaller, slower
            createFloatingEmoji(value, '😏', '1rem', 5);
          }
        }, 100);
      }
    }

    function createFloatingEmoji(numericValue, emojiChar = '😮', fontSize = '2rem', durationSeconds = 3) {
      const slider = document.getElementById('split');
      const sliderRect = slider.getBoundingClientRect();
      
      // Create emoji element
      const emoji = document.createElement('div');
      emoji.textContent = emojiChar;
      emoji.className = 'floating-emoji'; // Base class for position, z-index etc.
      emoji.style.fontSize = fontSize;

      // Apply animation based on duration
      if (durationSeconds === 5) {
        emoji.style.animation = 'floatUpQuickly 5s ease-out forwards';
        emoji.style.zIndex = '999'; // Behind the main emoji
      } else { // Default to 3s
        emoji.style.animation = 'floatUp 3s ease-out forwards';
        emoji.style.zIndex = '1000'; // Main emoji on top
      }
      
      // Position it at the slider thumb position
      const thumbPosition = (numericValue / 100) * sliderRect.width;
      // Centering logic: (slider edge + thumb offset) - half of typical emoji width at given font size
      // For 2rem font, 16px was used. For 1rem, 8px might be appropriate.
      // Let's use a rough estimate based on fontSize. 1rem ~ 16px, so half is 8px. 2rem ~ 32px, half is 16px.
      const approxHalfWidth = parseFloat(fontSize) * 8; // e.g., 2 * 8 = 16; 1 * 8 = 8
      emoji.style.left = (sliderRect.left + thumbPosition - approxHalfWidth) + 'px'; 
      emoji.style.top = (sliderRect.top + window.scrollY - 40) + 'px'; // Vertical positioning kept same for now
      
      // Add to body
      document.body.appendChild(emoji);
      
      // Remove after animation completes
      setTimeout(() => {
        if (emoji.parentNode) {
          emoji.parentNode.removeChild(emoji);
        }
      }, durationSeconds * 1000);
    }

    // Form submission and file handling logic will go here
    const submissionForm = document.getElementById('submission-form');
    const fileInput = document.getElementById('file-input');
    const dropzone = document.getElementById('dropzone');
    const fileListDisplay = document.getElementById('file-list');
    const submissionStatus = document.getElementById('submission-status');
    const nameInput = document.getElementById('name');
    const permissionCheckbox = document.getElementById('permission');
    const splitSlider = document.getElementById('split');
    const dropzoneHelperText = document.getElementById('dropzone-helper-text');
    const submitButton = document.getElementById('submit-generations-button');

    let selectedFiles = [];

    // Dropzone click triggers file input
    dropzone.addEventListener('click', () => fileInput.click());

    // Handle file selection via input
    fileInput.addEventListener('change', (event) => {
        handleFiles(event.target.files);
    });

    // Dropzone drag and drop events
    dropzone.addEventListener('dragover', (event) => {
        event.preventDefault();
        dropzone.style.backgroundColor = 'rgba(83, 83, 165, 0.15)';
        dropzone.style.borderColor = '#303070';
    });

    dropzone.addEventListener('dragleave', () => {
        dropzone.style.backgroundColor = 'rgba(83, 83, 165, 0.05)';
        dropzone.style.borderColor = '#5353a5';
    });

    dropzone.addEventListener('drop', (event) => {
        event.preventDefault();
        dropzone.style.backgroundColor = 'rgba(83, 83, 165, 0.05)';
        dropzone.style.borderColor = '#5353a5';
        handleFiles(event.dataTransfer.files);
    });

    function handleFiles(files) {
        if (!files) return;
        const newFiles = Array.from(files);
        // Simple way to avoid duplicates if user re-selects some of the same files, not perfect for all scenarios
        const combinedFiles = [...selectedFiles, ...newFiles].reduce((acc, current) => {
            if (!acc.find(item => item.name === current.name && item.size === current.size)) {
                acc.push(current);
            }
            return acc;
        }, []);
        selectedFiles = combinedFiles; // Remove the slice(0, 10) limit

        updateFileDisplay();
    }

    function updateFileDisplay() {
        fileListDisplay.innerHTML = '';
        if (selectedFiles.length > 0) {
            const list = document.createElement('ul');
            list.style.listStyleType = 'none';
            list.style.paddingLeft = '0';
            selectedFiles.forEach((file, index) => {
                const listItem = document.createElement('li');
                listItem.style.display = 'flex';
                listItem.style.justifyContent = 'space-between';
                listItem.style.alignItems = 'center';
                listItem.style.marginBottom = '0.5rem';
                listItem.style.padding = '0.25rem 0';
                
                const fileInfo = document.createElement('span');
                fileInfo.textContent = file.name + ' (' + (file.size / 1024).toFixed(2) + ' KB)';
                
                const removeButton = document.createElement('button');
                removeButton.textContent = '×';
                removeButton.style.background = 'none';
                removeButton.style.border = 'none';
                removeButton.style.color = '#999';
                removeButton.style.fontSize = '1.2rem';
                removeButton.style.cursor = 'pointer';
                removeButton.style.padding = '0 0.5rem';
                removeButton.style.marginLeft = '0.5rem';
                removeButton.style.borderRadius = '3px';
                removeButton.style.transition = 'color 0.2s ease';
                removeButton.onmouseover = () => removeButton.style.color = '#666';
                removeButton.onmouseout = () => removeButton.style.color = '#999';
                removeButton.onclick = (event) => {
                    event.stopPropagation();
                    removeFile(index);
                };
                
                listItem.appendChild(fileInfo);
                listItem.appendChild(removeButton);
                list.appendChild(listItem);
            });
            fileListDisplay.appendChild(list);
        }

        const buttonTooltip = document.getElementById('button-tooltip');
        
        if (selectedFiles.length >= 1) {
            submitButton.disabled = false;
            dropzoneHelperText.textContent = selectedFiles.length + ' file(s) selected.';
            buttonTooltip.style.display = 'none'; // Hide tooltip when enabled
            
            // Add hover effects for enabled button
            submitButton.onmouseover = function() {
                if (!this.disabled) {
                    this.style.transform = 'scale(1.02)';
                    this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
                }
            };
            submitButton.onmouseout = function() {
                if (!this.disabled) {
                    this.style.transform = 'scale(1)';
                    this.style.boxShadow = 'none';
                }
            };
        } else {
            submitButton.disabled = true;
            dropzoneHelperText.textContent = '(Min 1 file, any multimedia format)';
            buttonTooltip.style.display = 'block'; // Show tooltip when disabled
            
            // Remove hover effects for disabled button
            submitButton.onmouseover = null;
            submitButton.onmouseout = null;
        }
    }

    function removeFile(index) {
        selectedFiles.splice(index, 1);
        updateFileDisplay();
    }

    submissionForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        
        const uploaderName = nameInput.value.trim();
        const permissionGiven = permissionCheckbox.checked;
        const percentageToThem = parseInt(splitSlider.value, 10);
        const description = document.getElementById('description').value.trim();

        // Validation
        if (!uploaderName) {
            showSimpleStatus('Please enter your name.', 'red');
            return;
        }

        if (!permissionGiven) {
            showSimpleStatus('Please grant permission to use the generations.', 'red');
            return;
        }

        if (selectedFiles.length < 1) {
            showSimpleStatus('Please select at least 1 file to upload.', 'red');
            return;
        }

        // Start the enhanced progress system
        startProgressSystem();
        submitButton.disabled = true;

        try {
            const uploadedFileUrls = [];
            const uploadedFileNames = [];
            
            // Create progress items for each file
            createFileProgressItems();
            
            // Upload files one by one with progress tracking
            for (let i = 0; i < selectedFiles.length; i++) {
                const file = selectedFiles[i];
                updateProgressTitle(`Uploading file ${i + 1} of ${selectedFiles.length}...`);
                updateOverallProgress((i / selectedFiles.length) * 80); // Reserve 20% for database save
                
                try {
                    await uploadFileWithProgress(file, i);
                    
                    // Get the uploaded file info
                    const safeUploaderName = uploaderName.replace(/\s+/g, '-').replace(/[^a-zA-Z0-9-]/g, '');
                    
                    // Generate a UUID that works in all browsers
                    function generateUUID() {
                        // Try modern crypto.randomUUID first
                        if (typeof crypto !== 'undefined' && crypto.randomUUID) {
                            try {
                                return crypto.randomUUID();
                            } catch (e) {
                                // Fall through to fallback
                            }
                        }
                        
                        // Fallback UUID generation for older browsers or non-secure contexts
                        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                            const r = Math.random() * 16 | 0;
                            const v = c == 'x' ? r : (r & 0x3 | 0x8);
                            return v.toString(16);
                        });
                    }
                    
                    const fileName = `public/${safeUploaderName || 'anon'}/${generateUUID()}-${file.name}`;
                    
                    const { data, error } = await supabase.storage
                        .from('nft')
                        .upload(fileName, file, {
                            cacheControl: '3600',
                            upsert: false
                        });

                    if (error) {
                        throw new Error(`Upload failed: ${error.message}`);
                    }

                    const { data: publicURLData } = supabase.storage.from('nft').getPublicUrl(data.path);
                    uploadedFileUrls.push(publicURLData.publicUrl);
                    uploadedFileNames.push(file.name);
                    
                    updateFileStatus(i, 'completed', 'Uploaded ✓');
                    
                } catch (error) {
                    updateFileStatus(i, 'error', 'Failed ✗');
                    throw error;
                }
            }

            // Save to database
            updateProgressTitle('Saving submission details...');
            updateOverallProgress(90);
            updateProgressSummary('Finalizing submission...');

            const { error: dbError } = await supabase
                .from('nft')
                .insert({
                    uploader_name: uploaderName,
                    file_names: uploadedFileNames,
                    percentage_to_them: percentageToThem,
                    urls: uploadedFileUrls,
                    description: description || null
                });

            if (dbError) {
                throw new Error(`Database save failed: ${dbError.message}`);
            }

            // Success!
            updateProgressTitle('Upload Complete! 🎉');
            updateOverallProgress(100);
            updateProgressSummary(`Successfully uploaded ${selectedFiles.length} file(s)`);
            hideSpinner();
            
            setTimeout(() => {
                hideProgressSystem();
                showSimpleStatus('Submission successful! Thank you.', 'green');
                resetForm();
            }, 2000);

        } catch (error) {
            console.error('Submission error:', error);
            updateProgressTitle('Upload Failed');
            hideSpinner();
            updateProgressSummary(`Error: ${error.message}`);
            
            setTimeout(() => {
                hideProgressSystem();
                showSimpleStatus(`Error: ${error.message}`, 'red');
                submitButton.disabled = selectedFiles.length < 1;
            }, 3000);
        }
    });

    // Progress system helper functions
    function startProgressSystem() {
        document.getElementById('upload-progress-container').style.display = 'block';
        document.getElementById('submission-status').textContent = '';
        updateProgressTitle('Preparing upload...');
        updateOverallProgress(0);
        updateProgressSummary('');
    }

    function hideProgressSystem() {
        document.getElementById('upload-progress-container').style.display = 'none';
    }

    function updateProgressTitle(title) {
        document.getElementById('progress-title').textContent = title;
    }

    function updateOverallProgress(percentage) {
        document.getElementById('overall-progress-fill').style.width = percentage + '%';
    }

    function updateProgressSummary(text) {
        document.getElementById('progress-summary').textContent = text;
    }

    function hideSpinner() {
        document.getElementById('main-spinner').style.display = 'none';
    }

    function createFileProgressItems() {
        const container = document.getElementById('file-progress-list');
        container.innerHTML = '';
        
        selectedFiles.forEach((file, index) => {
            const item = document.createElement('div');
            item.className = 'file-progress-item';
            item.id = `file-progress-${index}`;
            
            item.innerHTML = `
                <div class="file-info">
                    <div class="file-name">${file.name}</div>
                    <div class="file-size">${(file.size / 1024).toFixed(2)} KB</div>
                    <div class="file-progress-bar">
                        <div class="file-progress-fill" id="file-progress-fill-${index}"></div>
                    </div>
                </div>
                <div class="file-status" id="file-status-${index}">
                    <span>Waiting...</span>
                </div>
            `;
            
            container.appendChild(item);
        });
    }

    async function uploadFileWithProgress(file, index) {
        const item = document.getElementById(`file-progress-${index}`);
        const statusElement = document.getElementById(`file-status-${index}`);
        const progressFill = document.getElementById(`file-progress-fill-${index}`);
        
        // Start upload animation
        item.classList.add('uploading');
        statusElement.innerHTML = '<div class="mini-spinner"></div><span>Uploading...</span>';
        
        // Simulate progress (since Supabase doesn't provide real upload progress)
        let progress = 0;
        const progressInterval = setInterval(() => {
            progress += Math.random() * 15;
            if (progress > 95) progress = 95; // Don't complete until actual upload is done
            progressFill.style.width = progress + '%';
        }, 200);
        
        // Wait a bit to show the progress animation
        await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 1200));
        
        clearInterval(progressInterval);
        progressFill.style.width = '100%';
    }

    function updateFileStatus(index, status, text) {
        const item = document.getElementById(`file-progress-${index}`);
        const statusElement = document.getElementById(`file-status-${index}`);
        
        item.className = `file-progress-item ${status}`;
        
        let icon = '';
        if (status === 'completed') icon = '✓';
        else if (status === 'error') icon = '✗';
        
        statusElement.innerHTML = `<span>${text}</span><span class="status-icon">${icon}</span>`;
    }

    function showSimpleStatus(message, color) {
        const statusElement = document.getElementById('submission-status');
        statusElement.textContent = message;
        
        // Special styling for success messages
        if (message.includes('Submission successful')) {
            statusElement.style.background = '#4CAF50';
            statusElement.style.color = 'white';
            statusElement.style.padding = '1rem';
            statusElement.style.borderRadius = '8px';
            statusElement.style.border = '2px solid #45a049';
            statusElement.style.fontWeight = '500';
            statusElement.style.boxShadow = '0 2px 8px rgba(76, 175, 80, 0.3)';
            statusElement.style.marginTop = '1rem';
        } else {
            // Reset styles for other messages
            statusElement.style.background = 'transparent';
            statusElement.style.padding = '0';
            statusElement.style.borderRadius = '0';
            statusElement.style.border = 'none';
            statusElement.style.fontWeight = 'normal';
            statusElement.style.boxShadow = 'none';
            statusElement.style.color = color;
        }
    }

    function resetForm() {
        submissionForm.reset();
        selectedFiles = [];
        fileListDisplay.innerHTML = '';
        dropzoneHelperText.textContent = '(Min 1 file, any multimedia format)';
        document.getElementById('banodocoPercent').textContent = '50%';
        document.getElementById('youPercent').textContent = '50%';
        document.getElementById('description').value = '';
        submitButton.disabled = true;
    }

  </script>
</body>
</html> 